/*! uu_oidcg01, 2.0.2, 2017-08-08 09:21:35Z */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("uu_appg01_core"),require("module")):"function"==typeof define&&define.amd?define("UuOidc",["uu_appg01_core","module"],t):"object"==typeof exports?exports.UuOidc=t(require("uu_appg01_core"),require("module")):e.UuOidc=t(e.UuApp,e.undefined)}(this,function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r=n(12),i=((r?r.uri:(document.currentScript||Array.prototype.slice.call(document.getElementsByTagName("script"),-1)[0]||{}).src)||"").toString();n.p=i.split(/\//).slice(0,-1).join("/")+"/",e.exports=n(16)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),o=r(i),u=n(4),s=r(u),a={};t.default={getMetadata:function(e){var t=e.replace(/\/+$/,""),n=a[t];if(n)return n;var r=t+"/.well-known/openid-configuration";return a[t]=s.default.wrapForImmediateThen(o.default.get(r).catch(function(e){throw delete a[t],e}))}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(5),s=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(u.Error.Error);t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),u=function(e){var t=Object.assign({},e),n={iframe:null};Object.defineProperty(n,"loginWindow",{get:function(){try{return null!=n.iframe?n.iframe.contentWindow:null}catch(e){}return null}}),o.default.registerForCallback(this,n),this.finalize=function(e){this.destroy(),t.onResult&&t.onResult(e)}.bind(this),this.render=function(){n.iframe||(n.iframe=document.createElement("iframe"),n.iframe.style.cssText="position: absolute;top: -300px; left: -300px; width: 200px; height: 200px; opacity: 0;",n.iframe.src=t.url,document.body.appendChild(n.iframe))},this.destroy=function(){n.iframe&&n.iframe.parentNode&&n.iframe.parentNode.removeChild(n.iframe),this.destroy=function(){},o.default.unregisterForCallback(this)}};t.default=u},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={wrapForImmediateThen:function(e){return e.then(function(t){return e._immediateValue=t},function(t){return e._immediateError=t}),e},immediateThen:function(e,t,n){if("_immediateValue"in e)return"function"==typeof t?t(e._immediateValue):e._immediateValue;if("_immediateError"in e){if("function"==typeof n)return n(e._immediateError);throw e._immediateError}return e.then(t,n)}}},function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=document.createElement("a");return t.href=e,t.href.toString()}function u(){if(!(N.currentSession.isAuthenticated()||N.currentSession._loginInProgress.length>0)){var e;return location.search.replace(/[?&]access_token=([^&#]*)/,function(t,n){e=decodeURIComponent(n.replace(/\+/g," "))}),e?N.currentSession._login({access_token:e,nonce:null}):N.currentSession._login({prompt:"none",acr_values:"1"}).catch(function(e){if(!(e&&"object"==("undefined"==typeof e?"undefined":s(e))&&"string"==typeof e.error_description&&e.error_description.match(/interaction/i)&&e.error_description.match(/required/i)))throw e})}}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(5),l=n(13),f=r(l),d=n(7),p=r(d),h=n(14),v=r(h),m=n(23),g=r(m),y=n(18),w=r(y),_=n(2),b=r(_),k=n(17),O=r(k),x=n(1),S=r(x),C=n(24),T=r(C),I=n(22),j=r(I),P=n(4),U=r(P),R=n(11),E=r(R),M=n(3),J=r(M),A=c.Error.Error,N=function(){function e(t){var n=this;if(i(this,e),!t)throw new A("Session must be initialized with proper options or UuApp.Util.Config.");this._optionsMergedPromise=U.default.wrapForImmediateThen(Promise.resolve(t&&"function"==typeof t.get?t.initPromise:t).then(function(e){if(e&&"function"==typeof e.get?(n.serverUri=e.get("uuoidc.serverUri",!1),n.clientId=e.get("uuoidc.clientId",!1),n.implicitFlowRedirectUri=e.get("uuoidc.redirectUri",!1),n.sessionCheckInterval=e.get("uuoidc.sessionCheckInterval",!1)):e&&(n.serverUri=e.serverUri,n.clientId=e.clientId,n.implicitFlowRedirectUri=e.redirectUri,n.sessionCheckInterval=e["uuoidc.sessionCheckInterval"]),null==n.serverUri&&(n.serverUri=f.default.serverUri),null==n.clientId&&(n.clientId="uu-oidc:unregistered-client:"+(0,g.default)()),null==n.sessionCheckInterval&&(n.sessionCheckInterval=f.default.sessionCheckInterval),n.implicitFlowRedirectUri||(n.implicitFlowRedirectUri="callbacks/oidc-callback.html"),!n.implicitFlowRedirectUri.match(/^[a-z]+:/i)){var t=o(document.baseURI||location.pathname).replace(/^([^?#]*\/).*/,"$1");"/"!=n.implicitFlowRedirectUri.charAt(0)?n.implicitFlowRedirectUri=o(t+n.implicitFlowRedirectUri):n.implicitFlowRedirectUri=o(n.implicitFlowRedirectUri)}var r=1e3*Math.max(5,n.sessionCheckInterval),i=function(){var e=this;return this._loginCtx?void this._login({acr_values:"1",prompt:"none"},!1).then(function(){setTimeout(i,r)},function(t){delete e._loginCtx,e._runListeners(),setTimeout(i,r)}):setTimeout(i,r)}.bind(n);setTimeout(i,r)})),this._loginInProgress=[];var r=[];this.isAuthenticated=function(){return!!n._loginCtx},this.addIdentityChangeListener=function(e){return r.push(e),n.removeIdentityChangeListener.bind(n,e)},this.removeIdentityChangeListener=function(e){var t=r.indexOf(e);return t!=-1&&r.splice(t,1),t!=-1},this._runListeners=function(){var e=n.getIdentity();r.forEach(function(t){return t.call(n,e)})},this.nonce=Math.random().toString(32).substr(2),this.addIdentityChangeListener(function(e){n._sessionRefreshTimeout&&(clearTimeout(n._sessionRefreshTimeout),delete n._sessionRefreshTimeout);var t=n.getClaims(),r=(t||{}).exp;if(r){r*=1e3;var i=3e5,o=(new Date).getTime(),u=r-o-i;u<0&&(u=0),n._sessionRefreshTimeout=setTimeout(function(){delete n._sessionRefreshTimeout,n._login({prompt:"none",acr_values:"1"}).catch(function(e){if(!n._sessionRefreshTimeout){var t=Math.max(0,r-(new Date).getTime()-3e4);n._sessionRefreshTimeout=setTimeout(function(){delete n._loginCtx,n._runListeners()},t)}})},u)}})}return a(e,[{key:"getIdentity",value:function(){return this._loginCtx?this._loginCtx.getIdentity():null}},{key:"getClaims",value:function(){return this._loginCtx?this._loginCtx.getClaims():null}},{key:"login",value:function(e){var t;return e&&(t=Object.keys(e).reduce(function(t,n){return t[E.default.toSnakeCase(n)]=e[n],t},{})),this._login(t,!0)}},{key:"_login",value:function(t){var n,r=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=Object.assign({},t);"urn:ietf:params:oauth:token-type:jwt-uuos8"===o.token_type_hint&&(n=o.access_token,delete o.access_token,delete o.token_type_hint);var u=o.access_token;delete o.access_token;var s=function(){if(r._loginInProgress.push(1),0==Object.keys(o).length&&(o.acr_values=1),!u&&r._loginCtx){var e=!0;(o.prompt||o.max_age||o.access_token)&&(e=!1);var t=(null!=o.acr_values?o.acr_values+"":"").split(/\s+/),s=r.getIdentity();if(t.every(function(e){return Number(e)>s.loginLevelOfAssurance})&&(e=!1),r._authResponseExpired(r._loginCtx.authResponse)&&(e=!1),e)return r._loginInProgress.pop(),Promise.resolve(r)}var a,c=u?{id_token:u}:null,l=u||"nonce"in o?o.nonce:r.nonce,f=Promise.resolve(c||U.default.immediateThen(r._optionsMergedPromise,function(){if(n){l=null;var e=new T.default({serverUri:r.serverUri,clientId:r.clientId,redirectUri:r.implicitFlowRedirectUri});return e.grantExchangeToken({subject_token:n})}return o.nonce=l,o.state=a=Math.random().toString(32).substr(2),p.default.login({serverUri:r.serverUri,clientId:r.clientId,redirectUri:r.implicitFlowRedirectUri,loginParams:o})},function(e){return Promise.reject(e)}));return f.then(function(e){if(a&&e.state!==a)throw new A("Invalid 'state' in received token. Expected "+a+" but got "+e.state+". Token: "+JSON.stringify(e));if(r._authResponseExpired(e))throw new A("Token expired "+JSON.stringify(e));return r._validateIdToken(e.id_token,l).then(function(t){return i!==!1&&(r._loginCtx=new v.default(o,e,t),r._runListeners()),r})}).then(function(e){return r._loginInProgress.pop(),e},function(e){return r._loginInProgress.pop(),Promise.reject(e)})};return this!==e.currentSession||u||n||0!==Object.keys(o).length?s():U.default.immediateThen(e.initPromise,s)}},{key:"logout",value:function(){var e=this;return this._loginCtx?this._optionsMergedPromise.then(function(){return new Promise(function(t,n){var r=e.serverUri,i=e.implicitFlowRedirectUri,o=r+"/logout?redirect_uri="+encodeURIComponent(i);new J.default({url:o,onResult:function(n){delete e._loginCtx,e._runListeners(),t()}}).render()})}):Promise.resolve()}},{key:"getCallToken",value:function(e){var t=(this._loginCtx||{}).authResponse;if(!t)return null;var n={tokenType:t.token_type||null,token:t.id_token||null};return n}},{key:"_authResponseExpired",value:function(e){var t=(new Date).getTime()/1e3,n=60,r=!1;return e.issued_at||(e.issued_at=t),e.expires_at&&(r=r||e.expires_at<t-n),e.expires_in&&e.issued_at&&(r=r||Number(e.expires_in)+Number(e.issued_at)<t-n),r}},{key:"_validateIdToken",value:function(e,t){var n=this;return this._optionsMergedPromise.then(function(){return S.default.getMetadata(n.serverUri).then(function(r){var i={alg:["RS256"],iss:[r.issuer],gracePeriod:300};return w.default.decode(e,i,function(t){if(!t.alg||!t.alg.match(/^RS\d+$/))throw new A("Invalid token. Only RSA signature is supported, but token uses algorithm '"+t.alg+"'. Token: "+e);var i="RSA",o=r.id_token_signing_alg_values_supported||[];if(o.indexOf(t.alg)==-1)throw new A("Invalid token. Token was signed using algorithm '"+t.alg+"' but the OIDC server '"+n.serverUri+"' supports only "+JSON.stringify(o)+". Token: "+e);var u=new O.default({serverUri:n.serverUri});return u.getKey(t.kid,i).catch(function(t){throw new A("Invalid token. Unable to match key from JWT header to list of keys used by OpenID Connect server "+n.serverUri+". Token: "+e,t)})}).then(function(e){if(t&&e.nonce!==t)throw new b.default("Invalid nonce in ID token claims. Expected "+t+" but got "+e.nonce);return e})})})}}]),e}();t.default=N;var W,F=!0;Object.defineProperty(N,"currentSession",{get:function(){return F&&!W&&(W=new N(c.Util.Config),W.initComplete=!1,W.initPromise=N.initPromise),W},set:function(e){F=!1,W=e}});var L;N.initPromise=U.default.wrapForImmediateThen(new Promise(function(e,t){L=function(t,n){return N.initComplete=!0,N.currentSession.initComplete=!0,t||console.log("Session initialization failed:",n),e(N.currentSession),N.initPromise}})),N.initComplete=!1;var z=new Function("try {return this===window;}catch(e){ return false;}")();z?j.default.domReady.then(function(){return Promise.resolve(u())}).then(L.bind(null,!0),L.bind(null,!1)):L(!0)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=r(i),u=n(4),s=r(u),a=n(21),c=r(a),l=n(3),f=r(l),d={login:function(e){var t=e||{},n=t.serverUri;if(!n)throw new Error("ImplicitFlow.login requires option 'serverUri'.");var r=t.clientId;if(!r)throw new Error("ImplicitFlow.login requires option 'clientId'.");var i=t.redirectUri;if(!i)throw new Error("ImplicitFlow.login requires option 'redirectUri'.");return s.default.immediateThen(o.default.getMetadata(n),function(e){var n=Object.assign({scope:"openid"},t.loginParams,{response_type:"id_token token",client_id:r,redirect_uri:i}),o=[];for(var u in n){var s=n[u];null!=s&&o.push(encodeURIComponent(u)+"="+encodeURIComponent(s+""))}var a=e.authorization_endpoint+"?"+o.join("&"),l=t.loginVisualComponent||("none"!=n.prompt?c.default:f.default);return new Promise(function(e,t){new l({url:a,onResult:function(n){var r=d.getAuthResponseFromCallback(n);return r===!1?t(new Error("User refused to sign in or the operation didn't complete successfully, e.g. due to popup blocking.")):void(r.error?t(r):e(r))}}).render()})},function(e){return Promise.reject(e)})},getAuthResponseFromCallback:function(e){if(e===!1)return e;var t={};return e.replace(/^[^#]*#?/,"").split(/&/).forEach(function(e){var n=e.indexOf("="),r=decodeURIComponent((n==-1?e.substr(0):e.substr(0,n)).replace(/\+/g," ")),i=decodeURIComponent((n==-1?"":e.substr(n+1)).replace(/\+/g," "));t[r]=i}),t}};t.default=d},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="uuOidcCallbackFn";"undefined"==typeof window||window[n]||(window[n]=function(e,t){for(var r=window[n].loginWindows,i=0;i<r.length;++i){var o=r[i];if(o.state.loginWindow==t)return void o.component.finalize(e)}console.warn("Received unexpected callback from window",t,"Passed result was:",e,"Ignoring the callback.")},window[n].loginWindows=[]),t.default={registerForCallback:function(e,t){window[n].loginWindows.push({component:e,state:t})},unregisterForCallback:function(e){for(var t=window[n].loginWindows,r=0;r<t.length;++r)if(t[r].component===e){t.splice(r,1);break}}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={encodeAscii:function(e){return e?btoa(e).replace(/\+/g,"-").replace(/\//g,"_"):e},encode:function(e){return e?n.encodeAscii(unescape(encodeURIComponent(e))):e},decodeToAscii:function(e){if(!e)return null;var t=e.replace(/-/g,"+").replace(/_/g,"/");return atob(t)},decode:function(e){var t=n.decodeToAscii(e);return null!=t?decodeURIComponent(escape(t)):null}};t.default=n},function(e,t){"use strict";function n(e,t,n,r){return new Promise(function(i,o){var u=new XMLHttpRequest;u.open(e,t,!0),u.withCredentials=!0,u.setRequestHeader("Accept","application/json"),u.onreadystatechange=function(e){if(4==u.readyState)if(u.status>=200&&u.status<300)try{var t=JSON.parse(u.responseText);i(t)}catch(e){o(e)}else o(new Error("Server responded with status "+u.status))},u.withCredentials=!0,r&&r(u),u.send(n)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default={get:function(){return n.bind(this,"GET").apply(this,Array.prototype.slice.call(arguments))},post:function(){return n.bind(this,"POST").apply(this,Array.prototype.slice.call(arguments))}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={toSnakeCase:function(e){return(e||"").replace(/[A-Z]/g,function(e){return"_"+e.toLowerCase()})}}},function(e,n){e.exports=t},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={serverUri:"https://oidc.plus4u.net/uu-oidcg01-main/0-0",sessionCheckInterval:60}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function e(t,r,i){n(this,e),this.loginOptions=t,this.authResponse=r,this.claims=i,this.getClaims=function(){return i};var o;this.getIdentity=function(){return o?o:o={id:i.sub,name:i.name,email:i.email,uuIdentity:i.uu_identity,levelOfAssurance:Number(i.loa),loginLevelOfAssurance:Number(i.acr)}}};t.default=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e,t,n){function r(i){if(++c>5)throw new a.Error.AbortError("Command invocation stopped because user was not able to fulfill login requirements for the command within "+c+" attempts.");var l=Object.assign({},s,i);return(Object.keys(l).length>0?o._login(l,!0):Promise.resolve(o)).catch(function(e){if(e===!1)throw new a.Error.AbortError("Command invocation stopped because user refused to log in.");throw new a.Error.Error("Command invocation stopped because of a login error.",e)}).then(function(t){var n=t.isAuthenticated();if(n){var r=e.uri.baseUri;return Promise.resolve(t.getCallToken(r.toString())).then(function(e){return{isAuthenticated:n,callToken:e}})}return{isAuthenticated:n,callToken:null}}).then(function(i){var o=i.isAuthenticated,s=i.callToken,a=s?s.token:null;return a&&(e.headers.authorization=[s.tokenType||"Bearer",a].join(" ")),n(e,t).catch(function(e){var t=e.headers("www-authenticate");if(t){var n={};t.replace(/^\S+\s+/,"").split(/,/).map(function(e){return e.trim()}).forEach(function(e){var t=e.indexOf("="),r=u(t==-1?e:e.substr(0,t)),i=u(t==-1?"":e.substr(t+1));n[r]=u(i)});var i=Object.keys(n).filter(function(e){return e.match(/^(max_age|acr_values|prompt|scope)$/)}).reduce(function(e,t){return e[t]=n[t],e},{});if(Object.keys(i).length>0)return r(i);if(!o)return r({acr_values:"1"})}return Promise.reject(e)})})}var i="authorization"in e.headers;if(i)return n(e,t);var o=t.session||l.default.currentSession,s=t["uuoidc.loginParameters"];s&&(s=Object.keys(s).reduce(function(e,t){return e[d.default.toSnakeCase(t)]=s[t],e},{}));var c=0;return r(null)}function u(e){return decodeURIComponent(e.replace(/\+/g," "))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var s=n(5),a=i(s),c=n(6),l=r(c),f=n(11),d=r(f)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SessionHandler=t.Session=void 0;var i=n(6),o=r(i),u=n(15),s=r(u);"undefined"!=typeof window&&(window.UuOidc={Session:o.default,SessionHandler:s.default}),t.Session=o.default,t.SessionHandler=s.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),s=r(u),a=n(10),c=r(a),l={},f=0,d=function(){function e(t){if(i(this,e),!t||!t.serverUri)throw new Error("Jwks must be initialized with options containing serverUri.");this.options=t}return o(e,[{key:"getKey",value:function(e,t){return this._getKey(e,t,!1)}},{key:"_getKey",value:function(e,t,n){var r=this;return s.default.getMetadata(this.options.serverUri).then(function(e){var t=l[e.jwks_uri];if(!t||n){var r=e.jwks_uri;n&&(r=r.replace(/(\?.*)?$/,function(e){return"?cachebust="+Date.now().toString(36)+"_"+(f++).toString(36)+(e?"&"+e.substr(1):"")})),t=l[e.jwks_uri]=c.default.get(r).then(function(e){return{jwkSet:e,url:r}})}return t}).then(function(i){var o=i.jwkSet,u=o.keys;if(e&&(u=u.filter(function(t){return t.kid===e})),t&&(u=u.filter(function(e){return e.kty===t})),1!=u.length){if(!n)return r._getKey(e,t,!0);throw new Error("There's "+u.length+" JSON Web Key(s) in JWK Set with kid='"+e+"' kty='"+t+"'. There must be exactly 1. JWK Set has been downloaded from: "+i.url)}return u[0]})}}]),e}();t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),o=r(i),u=n(2),s=r(u),a=n(20),c=r(a),l=n(19),f=r(l),d="undefined"!=typeof crypto&&crypto.subtle&&crypto.subtle.importKey,p=d&&("undefined"==typeof location||"https:"==location.protocol),h=p?c.default:f.default,v="RS256";t.default={decode:function(e,t,n){var r,i;return Promise.resolve().then(function(){if("string"!=typeof e)throw new Error("Invalid JSON Web Token - it must be a string (result of JWS / JWE Compact Serialization as per RFC7515 / RFC7516).");if(r=e.split("."),3!=r.length)throw new Error("Unsupported JSON Web Token - the token doesn't consist of header+body+signature (only JWS Compact Serialization is supported - RFC7515, section-3). Token: "+e);var t=r[0],u=o.default.decode(t);if(i=JSON.parse(u),"JWT"!=i.typ)throw new Error("Invalid JSON Web Token - the header 'typ' field is not set to 'JWT'. Token: "+e);return n(i)}).then(function(n){if(!n||"RSA"!=n.kty)throw new Error("Unsupported key type. Only RSA keys are supported for JSON Web Token signature verification. Key: "+JSON.stringify(n));var o=n.alg||v;if(o!==i.alg)throw new s.default("Invalid JSON Web Token or wrong verification key - algorithms don't match. Token uses '"+i.alg+"', verification key uses '"+n.alg+"' (with default of '"+v+"'). Token: "+e+" Key: "+JSON.stringify(n));return h.verify(n,o,t,i,r,e)}).then(function(t){if(!t)throw new s.default("Invalid JSON Web Token: "+e);var n=o.default.decode(r[1]),i=JSON.parse(n);return i})}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(12),o=r(i),u=((o.default?o.default.uri:(document.currentScript||Array.prototype.slice.call(document.getElementsByTagName("script"),-1)[0]||{}).src)||"").toString(),s=void 0,a={verify:function(e,t,n,r,i,o){var c=this;return Promise.resolve().then(function(){if(void 0===s){var l,f=a.verify.bind(c,e,t,n,r,i,o),d=u.indexOf(".min.")!=-1,p=u.replace(/^(.*\/).*/,"$1"),h=p+"jsrsasign"+(d?".min":"")+".js";return l="undefined"!=typeof System?System.import(h):new Promise(function(e,t){var n=document.createElement("script");n.onload=function(){e(window.Jsrsasign)},n.onerror=function(e){t(e)},n.src=h,document.head.appendChild(n)}),l.then(function(e){return s=e||null,f()},function(e){return console.error(e),s=null,f()})}if(!s)throw new Error("Unable to verify token because jsrsasign library failed to load.");var v=s.KEYUTIL.getKey(e),m=s.jws.JWS.verifyJWT(o,v,n);return m||Promise.reject(new Error("Token is not valid. Token: "+o))})}};e.exports=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return new Uint8Array(e.split("").map(function(e){return e.charCodeAt(0)}))}function o(e){return null==e?null:Array.isArray(e)?e:[e]}function u(e){return new Date(1e3*e).toISOString().replace(/T/," ")}var s=n(9),a=r(s),c=n(2),l=r(c);e.exports={verify:function(e,t,n,r,s,c){var f={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-"+t.substr(2)}},d=JSON.parse(JSON.stringify(e));return delete d.use,crypto.subtle.importKey("jwk",d,f,!1,["verify"]).then(function(e){var t=s[2],n=s[0]+"."+s[1],r=i(a.default.decodeToAscii(t)),o=i(n);return crypto.subtle.verify(e.algorithm,e,r,o)},function(e){var t=new Error("Unable to verify JSON Web Token - importing key via WebCrypto API failed.\nKey: "+JSON.stringify(d)+"\nToken: "+c+"\nError: "+e);return t.cause=e,Promise.reject(t)}).then(function(e){if(!e)throw new l.default("Invalid JSON Web Token - signature is not valid. Token: "+c);var t=a.default.decode(s[1]),i=JSON.parse(t),f=function(e,t){throw new l.default("Invalid token: "+e+"\nFailed claim: "+JSON.stringify(t)+"\nIssued by: "+JSON.stringify(i.iss)+"\nVerification options: "+JSON.stringify(n)+"\nToken: "+c)};if(!n.alg)throw new Error("Unable to verify JWT claim - 'alg' field must be always given for verification.");n.alg.indexOf(r.alg)==-1&&f("Algorithm "+JSON.stringify(r.alg)+" used by token is not valid - expected one of "+JSON.stringify(n.alg)+".","alg");var d;d=o(n.iss),d&&d.indexOf(i.iss)===-1&&f("Issuer URI "+JSON.stringify(i.iss)+" in token is not valid - expected one of "+JSON.stringify(d)+". Token was issued by different OpenID Connect server or it was forged.","iss"),d=o(n.sub),d&&d.indexOf(i.sub)===-1&&f("Subject "+JSON.stringify(i.sub)+" in token is not valid - expected one of "+JSON.stringify(d)+".","sub"),d=o(n.aud);var p=o(i.aud)||[];d&&p.some(function(e){return d.indexOf(e)==-1})&&f("Audience list "+JSON.stringify(p)+" in token is not valid - some of following values are missing: "+JSON.stringify(d)+".","aud");var h=Date.now()/1e3;n.verifyAt&&(h=n.verifyAt);var v=n.gracePeriod||0;return"number"==typeof i.exp&&i.exp+v<h&&f("Token already expired at "+u(i.exp)+", current time is "+u(h)+".","exp"),"number"==typeof i.nbf&&h<i.nbf-v&&f("Token is not yet valid - it will become valid at "+u(i.nbf)+", current time is "+u(h)+". Check that your system time is correctly set.","nbf"),"number"==typeof i.iat&&h<i.iat-v&&f("Token seems to have been issued in the future - "+u(i.iat)+", current time is "+u(h)+". Check that your system time is correctly set.","iat"),n.jti&&i.jti!==n.jti&&f("Token ID "+JSON.stringify(i.jti)+" not valid - expected "+JSON.stringify(n.jti)+".","jti"),!0})}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),u=function(e){var t=Object.assign({},e),n={loginWindow:null,closeCheckInterval:null};o.default.registerForCallback(this,n),this.finalize=function(e){this.destroy(),t.onResult&&t.onResult(e)}.bind(this);var r=function(){n.loginWindow&&n.loginWindow.closed&&this.finalize(!1)}.bind(this);this.render=function(){var e=this;if(!n.loginWindow){var i={width:599,height:600};i.left=(screen.availWidth-i.width)/2+screen.availLeft,i.top=(screen.availHeight-i.height)/2+screen.availTop,n.loginWindow=window.open(t.url,"_blank","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width="+i.width+",height="+i.height+",top="+i.top+",left="+i.left),n.loginWindow?n.closeCheckInterval=setInterval(r.bind(this),200):Promise.resolve().then(function(){return e.finalize(!1)})}},this.destroy=function(){n.loginWindow&&!n.loginWindow.closed&&n.loginWindow.close(),n.closeCheckInterval&&clearInterval(n.closeCheckInterval),this.destroy=function(){},o.default.unregisterForCallback(this)}};t.default=u},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=new Function("try {return this===window;}catch(e){ return false;}")(),r=n?"interactive"===document.readyState||"complete"===document.readyState?Promise.resolve():new Promise(function(e){document.addEventListener("DOMContentLoaded",e,!1)}):Promise.resolve();t.default={domReady:r}},function(e,t){"use strict";function n(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)});return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(3),s=r(u),a=n(7),c=r(a),l=function(){function e(t){if(i(this,e),!(t&&t.serverUri&&t.clientId&&t.redirectUri))throw new Error("Os8Auth must be initialized with options containing serverUri, clientId and redirectUri.");this.options=t}return o(e,[{key:"grantExchangeToken",value:function(e){var t=e||{};if(!t.subject_token)throw new Error("Os8Auth.grantExchangeToken must be called with parameter subject_token.");var n=Object.assign({},t,{response_type:"id_token token",client_id:this.options.clientId,redirect_uri:this.options.redirectUri}),r=Object.keys(n).filter(function(e){return null!=n[e]}).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e]+"")}),i=this.options.serverUri.replace(/\/*$/,"/")+"exchangeOs8Token?"+r.join("&");return new Promise(function(e,t){new s.default({url:i,onResult:function(n){var r=c.default.getAuthResponseFromCallback(n);!r||r.error?t(r):e(r)}}).render()})}}]),e}();t.default=l}])});
//# sourceMappingURL=uu_oidcg01.min.js.map