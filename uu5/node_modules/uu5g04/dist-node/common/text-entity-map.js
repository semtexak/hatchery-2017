export const HtmlEntityMap = {
  re: /(&#?[a-z0-9]+;)/g,
  items: {
    '&amp;': '&',
    '&#38;': '&',
    '&apos;': "'",
    '&#39;': "'",
    '&quot;': '"',
    '&#34;': '"',
    '&lt;': '<',
    '&#060;': '<',
    '&gt;': '>',
    '&#062;': '>',
    '&hellip;': 'â€¦',
    '&#133;': 'â€¦',
    '&mdash;': 'â€”',
    '&#8212;': 'â€”',
    '&pi;': 'Ï€',
    '&#8719;': 'Ï€',
    '&reg;': 'Â®',
    '&#174;': 'Â®',
    '&#8730;': 'âˆš',
    '&radic;': 'âˆš',
    '&#8734;': 'âˆ',
    '&infin;': 'âˆ',
    '&#160;': ' ',
    '&nbsp;': ' ',
    '&#8592;': 'â†',
    '&larr;': 'â†',
    '&#8594;': 'â†’',
    '&rarr;': 'â†’',
    '&#8595;': '?',
    '&darr;': '?',
    '&#169;': 'Â©',
    '&copy;': 'Â©',
    '&trade':'â„¢',
    '&pound;':'Â£',
    '&euro':'â‚¬',
    '&prod;':'âˆ',
    '&sum;':'âˆ‘',
    '&int;':'âˆ«',
    '&le;':'â‰¤',
    '&ge;':'â‰¥'
  }
};

export const AsciiEmojiMap = {
  //:) :D :O :* :( :| :S :Z :$ :P :/   ;-)     :'-(   ,:-(   ,:-)   O:-)       8-) X-)    :-")  :'-)        :,'-(          ";-(   ]:-)   <3
  re:/(:-?[)(DOo*|$SsZzP/@]|;-?\)|:[',]-?\(|,:-?\(|,:-?\)|[0oO]:-?\)|[B8Xx]-?\)|:-"\)|:[',]-?[)D]|:(?:,'|',)-?\(|";-?\(|]:-?\)|<\/?3)/g,
  items: {
    ":)": "ğŸ˜ƒ",
    ":-)": "ğŸ˜ƒ",
    ';)': "ğŸ˜‰",
    ';-)': "ğŸ˜‰",
    ":-(": "ğŸ˜¦",
    ":(": "ğŸ˜¦",
    ":'(": "ğŸ˜¢",
    ":'-(": "ğŸ˜¢",
    ":,(": "ğŸ˜¢",
    ":,-(": "ğŸ˜¢",
    ":D": "ğŸ˜„",
    ":-D": "ğŸ˜„",
    ":o": "ğŸ˜®",
    ":O": "ğŸ˜®",
    ":-o": "ğŸ˜®",
    ":-O": "ğŸ˜®",
    ":*": "ğŸ˜˜",
    ":-*": "ğŸ˜˜",
    ",:(": "ğŸ˜“",
    ",:-(": "ğŸ˜“",
    ",:)": "ğŸ˜…",
    ",:-)": "ğŸ˜…",
    "0:)": "ğŸ˜‡",
    "0:-)": "ğŸ˜‡",
    "o:)": "ğŸ˜‡",
    "O:)": "ğŸ˜‡",
    "O:-)": "ğŸ˜‡",
    "o:-)": "ğŸ˜‡",
    "8)": "ğŸ˜",
    "8-)": "ğŸ˜",
    "B)": "ğŸ˜",
    "B-)": "ğŸ˜",
    ':")': "ğŸ˜Š",
    ':-")': "ğŸ˜Š",
    ":$": "ğŸ˜’",
    ":-$": "ğŸ˜’",
    ":')": "ğŸ˜‚",
    ":'-)": "ğŸ˜‚",
    ":'-D": "ğŸ˜‚",
    ":'D": "ğŸ˜‚",
    ":,-)": "ğŸ˜‚",
    ":,)": "ğŸ˜‚",
    ":,-D": "ğŸ˜‚",
    ":,D": "ğŸ˜‚",
    ":,'(": "ğŸ˜­",
    ":,'-(": "ğŸ˜­",
    '";(': "ğŸ˜­",
    '";-(': "ğŸ˜­",
    ":-/": "ğŸ˜•",
    ":/": "ğŸ˜•",
    ":-@": "ğŸ˜¡",
    ":@": "ğŸ˜¡",
    ":-P": "ğŸ˜›",
    ":P": "ğŸ˜›",
    ":-S": "ğŸ˜’",
    ":-Z": "ğŸ˜’",
    ":S": "ğŸ˜’",
    ":Z": "ğŸ˜’",
    ":-s": "ğŸ˜’",
    ":-z": "ğŸ˜’",
    ":s": "ğŸ˜’",
    ":z": "ğŸ˜’",
    ":-|": "ğŸ˜",
    ":|": "ğŸ˜",
    "]:)": "ğŸ˜ˆ",
    "]:-)": "ğŸ˜ˆ",
    "X-)": "ğŸ˜†",
    "x-)": "ğŸ˜†",
    "X)": "ğŸ˜†",
    "x)": "ğŸ˜†",
    '</3': 'ğŸ’”',
    '<3': 'ğŸ’—'
  }
};

export const ExtendedEmojiMap = {
  re:/#\(([a-z\-]+)\)/g,
  items: {
    'cow' : 'ğŸ„',
    'horse' : 'ğŸ',
    'tiger' : 'ğŸ…',
    'elephant' : 'ğŸ˜',
    'unicorn-face' : 'ğŸ¦„',
    'pig' : 'ğŸ–',
    'pig-face' : 'ğŸ·',
    'pig-nose' : 'ğŸ½',
    'rat' : 'ğŸ€',
    'hamster-face' : 'ğŸ¹',
    'bat' : 'ğŸ¦‡',
    'chicken' : 'ğŸ”',
    'dolphin' : 'ğŸ¬',
    'fish' : 'ğŸŸ',
    'crocodile' : 'ğŸŠ',
    'snake' : 'ğŸ',
    'whale' : 'ğŸ‹',
    'octopus' : 'ğŸ™',
    'spider' : 'ğŸ•·',
    'panda-face' : 'ğŸ¼',
    'bear-face' : 'ğŸ»',
    'boar' : 'ğŸ—',
    'dog' : 'ğŸ•',
    'dog-face' : 'ğŸ¶',
    'cat' : 'ğŸˆ',
    'cat-face' : 'ğŸ±',
    'fire' : 'ğŸ”¥',
    'skull-with-crossbones' : 'â˜ ',
    'bomb' : 'ğŸ’£',
    'light-bulb' : 'ğŸ’¡',
    'hammer' : 'ğŸ”¨',
    'wrench' : 'ğŸ”§',
    'key' : 'ğŸ”‘',
    'gear' : 'âš™',
    'coffin' : 'âš°',
    'moai' : 'ğŸ—¿',
    'beer' : 'ğŸº',
    'volcano' : 'ğŸŒ‹',
    'pile-of-poo' : 'ğŸ’©',
    'shit' : 'ğŸ’©',
    'czechia' : 'ğŸ‡¨ğŸ‡¿',
    'united-states' : 'ğŸ‡ºğŸ‡¸',
    'germany' : 'ğŸ‡©ğŸ‡ª',
    'ukraine' : 'ğŸ‡ºğŸ‡¦',
    'slovakia' : 'ğŸ‡¸ğŸ‡°',
    'netherlands' : 'ğŸ‡³ğŸ‡±',
    'spain' : 'ğŸ‡ªğŸ‡¸',
    'united-kingdom' : 'ğŸ‡¬ğŸ‡§',
    'croatia' : 'ğŸ‡­ğŸ‡·'
  }
};

export const TextEntityMap = {
  _re: null,
  _htmlEntity: true,
  get htmlEntity() {return this._htmlEntity},
  set htmlEntity(s) {
    if (s !== this._htmlEntity) {
      this._htmlEntity = s;
      this.recompile();
    }
  },
  _htmlEntityMap : HtmlEntityMap,
  replaceHtmlEntity(key) { return this._htmlEntityMap[key] || key },

  _asciiEmoji: true,
  get asciiEmoji() {return this._asciiEmoji},
  set asciiEmoji(s) {
    if (s !== this.asciiEmoji) {
      this._asciiEmoji = s;
      this.recompile();
    }
  },
  _asciiEmojiMap : AsciiEmojiMap,
  replaceAsciiEmoji(key) { return this._asciiEmojiMap[key] || key },

  _extendedTextEntity: true,
  get extendedTextEntity() {return this._extendedTextEntity},
  set extendedTextEntity(s) {
    if (s !== this._extendedTextEntity) {
      this._extendedTextEntity = s;
      this.recompile();
    }
  },
  _extendedTextEntityMapList:[ExtendedEmojiMap],
  _textEntityRegexGroups:{},

  replace(text) {
    const eteg = this._textEntityRegexGroups;
    const count = this._reGroupsCount;

    return text.replace(this._re,(match,esc,...groups) => {
      let r = match;
      if (esc) r = match.slice(1);
      else
        for (let i = 0; i < count; i++) {
          if (groups[i]) { r = eteg[i].items[groups[i]]; break}
        }
      return r;
    });
  },

  addExtendedTextEntityMap(map) {
    if (!this._extendedTextEntityMapList.some( item => item === map )) this._extendedTextEntityMapList.push(map);
  },
  removeExtendedTextEntityMap(map) {
    this._extendedTextEntityMapList = this._extendedTextEntityMapList.filter( item => item !== map)
  },

  get extendedTextEntityMapList() { return this._extendedTextEntityMapList },

  recompile() {
    if (this.htmlEntity || this.asciiEmoji || this.extendedTextEntity) {
      let reA = [];
      let i = 0;
      this._textEntityRegexGroups = {};
      if (this.htmlEntity) {
        reA.push(this._htmlEntityMap.re.source);
        this._textEntityRegexGroups[i] = this._htmlEntityMap;
        i++;
      }
      if (this.asciiEmoji) {
        reA.push(this._asciiEmojiMap.re.source);
        this._textEntityRegexGroups[i] = this._asciiEmojiMap;
        i++;
      }
      if (this.extendedTextEntity) {
        this._extendedTextEntityMapList.forEach(item => {
          reA.push(item.re.source);
          this._textEntityRegexGroups[i] = item;
          i++;
        });
      }
      this._reGroupsCount = i;
      this._re = new RegExp(`(\\\\)?(?:${ reA.join('|') })`,'g');

    } else
      this._re = null;
  }
};

//precompile regex
TextEntityMap.recompile();

